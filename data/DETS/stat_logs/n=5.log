nohup: ignoring input
Namespace(target_csv='enthalpy/atct.csv', source_csv='enthalpy/wudily_cho.csv', pretrained='./df_core.pt', batch_size=128, epochs=200, ft_epochs=150, hidden_dim=256, layers=3, dropout=0.2, lr=0.0005, wd=1e-06, patience=50, device='cuda:0', num_prototypes=5, tau_high=0.9, sigma_0=0.1, gamma=0.5, alpha=0.9, w_min=1e-05)
--- DETS Full Pipeline: Stabilized Loss & Orthogonal Init ---
Device: cuda:0
-> Loading TARGET (Experiment) Dataset: enthalpy/atct.csv
Processing enthalpy/atct.csv...
-> Loaded 358 valid molecules from 358 rows.
-> Loading SOURCE (Theory) Dataset: enthalpy/wudily_cho.csv
Processing enthalpy/wudily_cho.csv...
-> Loaded 6074 valid molecules from 6074 rows.
-> Target Statistics: Mean=14.0561, Std=51.2793
-> [Warning] No pretrained weights found. Starting from SCRATCH.

==================================================
PHASE 1: DETS Source Training
==================================================
-> Extracting Anchors from Target (Experiment) Data...
   Running K-Means (K=5)...
-> Anchors Established: 5 prototypes.
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 1.0000
-> [Epoch 1] HighConf>0.1: 5847 (96.3%)
[P1] Epoch 001 | Loss 0.1094 | Val MAE 98.9179 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0332
-> [Epoch 2] HighConf>0.1: 168 (2.8%)
[P1] Epoch 002 | Loss 0.0165 | Val MAE 69.8240 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0019
-> [Epoch 3] HighConf>0.1: 18 (0.3%)
[P1] Epoch 003 | Loss 0.0029 | Val MAE 70.2907 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0214
-> [Epoch 4] HighConf>0.1: 54 (0.9%)
[P1] Epoch 004 | Loss 0.0035 | Val MAE 51.0319 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0109
-> [Epoch 5] HighConf>0.1: 23 (0.4%)
[P1] Epoch 005 | Loss 0.0014 | Val MAE 47.6285 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0153
-> [Epoch 6] HighConf>0.1: 39 (0.6%)
[P1] Epoch 006 | Loss 0.0007 | Val MAE 41.4094 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0184
-> [Epoch 7] HighConf>0.1: 47 (0.8%)
[P1] Epoch 007 | Loss 0.0007 | Val MAE 40.3745 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0147
-> [Epoch 8] HighConf>0.1: 40 (0.7%)
[P1] Epoch 008 | Loss 0.0005 | Val MAE 42.8918 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0186
-> [Epoch 9] HighConf>0.1: 58 (1.0%)
[P1] Epoch 009 | Loss 0.0004 | Val MAE 43.6136 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0221
-> [Epoch 10] HighConf>0.1: 81 (1.3%)
[P1] Epoch 010 | Loss 0.0004 | Val MAE 40.2365 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0078
-> [Epoch 11] HighConf>0.1: 21 (0.3%)
[P1] Epoch 011 | Loss 0.0003 | Val MAE 41.1265 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0205
-> [Epoch 12] HighConf>0.1: 80 (1.3%)
[P1] Epoch 012 | Loss 0.0003 | Val MAE 44.2021 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0121
-> [Epoch 13] HighConf>0.1: 42 (0.7%)
[P1] Epoch 013 | Loss 0.0003 | Val MAE 44.2079 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0139
-> [Epoch 14] HighConf>0.1: 46 (0.8%)
[P1] Epoch 014 | Loss 0.0003 | Val MAE 44.2972 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0070
-> [Epoch 15] HighConf>0.1: 67 (1.1%)
[P1] Epoch 015 | Loss 0.0003 | Val MAE 49.0787 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0224
-> [Epoch 16] HighConf>0.1: 75 (1.2%)
[P1] Epoch 016 | Loss 0.0002 | Val MAE 45.7234 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0299
-> [Epoch 17] HighConf>0.1: 112 (1.8%)
[P1] Epoch 017 | Loss 0.0002 | Val MAE 50.0959 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0157
-> [Epoch 18] HighConf>0.1: 49 (0.8%)
[P1] Epoch 018 | Loss 0.0002 | Val MAE 52.6200 | Acc 8.33%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0261
-> [Epoch 19] HighConf>0.1: 95 (1.6%)
[P1] Epoch 019 | Loss 0.0002 | Val MAE 51.9041 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0094
-> [Epoch 20] HighConf>0.1: 14 (0.2%)
[P1] Epoch 020 | Loss 0.0002 | Val MAE 52.8935 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0374
-> [Epoch 21] HighConf>0.1: 157 (2.6%)
[P1] Epoch 021 | Loss 0.0002 | Val MAE 54.7079 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0163
-> [Epoch 22] HighConf>0.1: 45 (0.7%)
[P1] Epoch 022 | Loss 0.0002 | Val MAE 54.3212 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0213
-> [Epoch 23] HighConf>0.1: 70 (1.2%)
[P1] Epoch 023 | Loss 0.0002 | Val MAE 52.5980 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0317
-> [Epoch 24] HighConf>0.1: 122 (2.0%)
[P1] Epoch 024 | Loss 0.0002 | Val MAE 57.3741 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0126
-> [Epoch 25] HighConf>0.1: 32 (0.5%)
[P1] Epoch 025 | Loss 0.0002 | Val MAE 58.3440 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0316
-> [Epoch 26] HighConf>0.1: 131 (2.2%)
[P1] Epoch 026 | Loss 0.0002 | Val MAE 57.0747 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0174
-> [Epoch 27] HighConf>0.1: 55 (0.9%)
[P1] Epoch 027 | Loss 0.0002 | Val MAE 57.2261 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0223
-> [Epoch 28] HighConf>0.1: 75 (1.2%)
[P1] Epoch 028 | Loss 0.0002 | Val MAE 59.0248 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0146
-> [Epoch 29] HighConf>0.1: 41 (0.7%)
[P1] Epoch 029 | Loss 0.0001 | Val MAE 60.2609 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0271
-> [Epoch 30] HighConf>0.1: 114 (1.9%)
[P1] Epoch 030 | Loss 0.0002 | Val MAE 53.6190 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0192
-> [Epoch 31] HighConf>0.1: 60 (1.0%)
[P1] Epoch 031 | Loss 0.0001 | Val MAE 58.2340 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0134
-> [Epoch 32] HighConf>0.1: 35 (0.6%)
[P1] Epoch 032 | Loss 0.0001 | Val MAE 54.6875 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0236
-> [Epoch 33] HighConf>0.1: 86 (1.4%)
[P1] Epoch 033 | Loss 0.0001 | Val MAE 56.3836 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0213
-> [Epoch 34] HighConf>0.1: 81 (1.3%)
[P1] Epoch 034 | Loss 0.0001 | Val MAE 55.7807 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0379
-> [Epoch 35] HighConf>0.1: 144 (2.4%)
[P1] Epoch 035 | Loss 0.0001 | Val MAE 54.0267 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0227
-> [Epoch 36] HighConf>0.1: 84 (1.4%)
[P1] Epoch 036 | Loss 0.0001 | Val MAE 54.3481 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0302
-> [Epoch 37] HighConf>0.1: 128 (2.1%)
[P1] Epoch 037 | Loss 0.0001 | Val MAE 59.2639 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0165
-> [Epoch 38] HighConf>0.1: 57 (0.9%)
[P1] Epoch 038 | Loss 0.0001 | Val MAE 57.6305 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0197
-> [Epoch 39] HighConf>0.1: 61 (1.0%)
[P1] Epoch 039 | Loss 0.0001 | Val MAE 58.9291 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0143
-> [Epoch 40] HighConf>0.1: 45 (0.7%)
[P1] Epoch 040 | Loss 0.0001 | Val MAE 55.7042 | Acc 8.33%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0262
-> [Epoch 41] HighConf>0.1: 119 (2.0%)
[P1] Epoch 041 | Loss 0.0001 | Val MAE 61.6939 | Acc 8.33%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0281
-> [Epoch 42] HighConf>0.1: 99 (1.6%)
[P1] Epoch 042 | Loss 0.0001 | Val MAE 55.8165 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0223
-> [Epoch 43] HighConf>0.1: 78 (1.3%)
[P1] Epoch 043 | Loss 0.0001 | Val MAE 58.7920 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0340
-> [Epoch 44] HighConf>0.1: 123 (2.0%)
[P1] Epoch 044 | Loss 0.0001 | Val MAE 59.4687 | Acc 8.33%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0356
-> [Epoch 45] HighConf>0.1: 146 (2.4%)
[P1] Epoch 045 | Loss 0.0001 | Val MAE 56.2035 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0233
-> [Epoch 46] HighConf>0.1: 84 (1.4%)
[P1] Epoch 046 | Loss 0.0001 | Val MAE 56.0869 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0249
-> [Epoch 47] HighConf>0.1: 84 (1.4%)
[P1] Epoch 047 | Loss 0.0001 | Val MAE 53.7575 | Acc 11.11%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0112
-> [Epoch 48] HighConf>0.1: 20 (0.3%)
[P1] Epoch 048 | Loss 0.0001 | Val MAE 61.1025 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0125
-> [Epoch 49] HighConf>0.1: 23 (0.4%)
[P1] Epoch 049 | Loss 0.0001 | Val MAE 55.8113 | Acc 8.33%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0256
-> [Epoch 50] HighConf>0.1: 89 (1.5%)
[P1] Epoch 050 | Loss 0.0001 | Val MAE 56.1690 | Acc 0.00%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0129
-> [Epoch 51] HighConf>0.1: 32 (0.5%)
[P1] Epoch 051 | Loss 0.0001 | Val MAE 54.7574 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0156
-> [Epoch 52] HighConf>0.1: 35 (0.6%)
[P1] Epoch 052 | Loss 0.0001 | Val MAE 57.7198 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0163
-> [Epoch 53] HighConf>0.1: 39 (0.6%)
[P1] Epoch 053 | Loss 0.0001 | Val MAE 57.4267 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0052
-> [Epoch 54] HighConf>0.1: 6 (0.1%)
[P1] Epoch 054 | Loss 0.0001 | Val MAE 50.9659 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0320
-> [Epoch 55] HighConf>0.1: 118 (1.9%)
[P1] Epoch 055 | Loss 0.0001 | Val MAE 56.6830 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0316
-> [Epoch 56] HighConf>0.1: 110 (1.8%)
[P1] Epoch 056 | Loss 0.0001 | Val MAE 56.6274 | Acc 2.78%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0340
-> [Epoch 57] HighConf>0.1: 136 (2.2%)
[P1] Epoch 057 | Loss 0.0001 | Val MAE 53.2603 | Acc 13.89%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0240
-> [Epoch 58] HighConf>0.1: 80 (1.3%)
[P1] Epoch 058 | Loss 0.0001 | Val MAE 50.9998 | Acc 8.33%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0296
-> [Epoch 59] HighConf>0.1: 105 (1.7%)
[P1] Epoch 059 | Loss 0.0001 | Val MAE 50.8002 | Acc 5.56%
   [Debug] Range Filter dropped 213 molecules (Out of [-114.1, 142.3]).
   [Debug] Active Weights Mean: 0.0321
-> [Epoch 60] HighConf>0.1: 113 (1.9%)
[P1] Epoch 060 | Loss 0.0001 | Val MAE 54.4691 | Acc 5.56%
Phase 1 Early stopping.
------------------------------------------------------------
[phase1 RESULT] Performance on Test Set:
   MAE:      67.4394 kcal/mol
   RMSE:     88.6528 kcal/mol
   MAPE:     313.60 %
   Acc(10%): 5.56 %  <-- Key Metric
------------------------------------------------------------

==================================================
PHASE 2: Target Fine-tuning
   Strategy: Freeze GNN first -> Align Head -> Unfreeze All
==================================================
>>> Stage 2.1: Aligning Prediction Head (Backbone Frozen)...
[P2-Head] Epoch 10 | Val MAE 36.6433 | Acc 0.00%
[P2-Head] Epoch 20 | Val MAE 35.7142 | Acc 0.00%
[P2-Head] Epoch 30 | Val MAE 38.9001 | Acc 0.00%
[P2-Head] Epoch 40 | Val MAE 37.8531 | Acc 0.00%
[P2-Head] Epoch 50 | Val MAE 38.3958 | Acc 2.78%
[P2-Head] Epoch 60 | Val MAE 37.9503 | Acc 2.78%
[P2-Head] Epoch 70 | Val MAE 36.0667 | Acc 2.78%
[P2-Head] Epoch 80 | Val MAE 37.3800 | Acc 5.56%
[P2-Head] Epoch 90 | Val MAE 37.3493 | Acc 2.78%
[P2-Head] Epoch 100 | Val MAE 38.0625 | Acc 2.78%
[P2-Head] Epoch 110 | Val MAE 38.7858 | Acc 2.78%
[P2-Head] Epoch 120 | Val MAE 39.9736 | Acc 0.00%
[P2-Head] Epoch 130 | Val MAE 38.3952 | Acc 5.56%
[P2-Head] Epoch 140 | Val MAE 36.8426 | Acc 5.56%
[P2-Head] Epoch 150 | Val MAE 38.8291 | Acc 5.56%

>>> Stage 2.2: Fine-tuning Whole Model...
[P2-Full] Epoch 010 | Loss 0.6150 | Val MAE 37.5398 | Acc 2.78%
[P2-Full] Epoch 020 | Loss 0.5924 | Val MAE 37.1529 | Acc 0.00%
[P2-Full] Epoch 030 | Loss 0.6062 | Val MAE 36.3786 | Acc 0.00%
[P2-Full] Epoch 040 | Loss 0.5830 | Val MAE 37.2034 | Acc 2.78%
[P2-Full] Epoch 050 | Loss 0.5863 | Val MAE 38.0337 | Acc 2.78%
[P2-Full] Epoch 060 | Loss 0.5432 | Val MAE 36.1537 | Acc 0.00%
[P2-Full] Epoch 070 | Loss 0.5257 | Val MAE 37.0330 | Acc 2.78%
[P2-Full] Epoch 080 | Loss 0.5521 | Val MAE 36.3152 | Acc 2.78%
[P2-Full] Epoch 090 | Loss 0.5463 | Val MAE 37.2103 | Acc 0.00%
[P2-Full] Epoch 100 | Loss 0.4968 | Val MAE 34.5882 | Acc 0.00%
[P2-Full] Epoch 110 | Loss 0.4999 | Val MAE 34.6442 | Acc 2.78%
[P2-Full] Epoch 120 | Loss 0.5111 | Val MAE 33.7993 | Acc 5.56%
[P2-Full] Epoch 130 | Loss 0.4839 | Val MAE 33.9388 | Acc 5.56%
[P2-Full] Epoch 140 | Loss 0.4742 | Val MAE 35.2572 | Acc 2.78%
[P2-Full] Epoch 150 | Loss 0.4856 | Val MAE 38.8021 | Acc 2.78%

>>> Testing Final Model...
------------------------------------------------------------
[FINAL RESULT] Performance on Test Set:
   MAE:      25.1974 kcal/mol
   RMSE:     36.9861 kcal/mol
   MAPE:     92.37 %
   Acc(10%): 11.11 %  <-- Key Metric
------------------------------------------------------------
